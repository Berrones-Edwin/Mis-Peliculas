<ng-container  *ngIf="movie$ | async as movie; else loading">


  <div class="row mt-4">

    <section class="poster-container col-sm-12 col-md-12 mb-3 col-lg-4" >

      <img class=" mb-4 shadow-lg" 
            src="{{ movie.poster_path | image}}" 
            alt="{{ movie.title }}"
            title="{{ movie.title }}"
            width="300"
            height="500">


      <div class="container-left-btn">

        <button (click)="addToFavorites()" class="btn btn-outline-danger mr-2">
            <span><i class="fas fa-heart"></i></span>
            Favoritos
        </button>
        <ng-container  *ngIf="movie && movie.videos.results[0].key">
          <a href="https://www.youtube.com/watch?v={{ movie.videos.results[0].key }}" 
            target="_blank" 
            class="btn btn-outline-warning"
           >
              Mirar trailer
              
          </a>
        </ng-container>
      
        <ng-template #elseTrailer>
          <button [disabled]="true" class="btn btn-outline-warning watch-trailer">No tengo Trailer</button>
        </ng-template>
       
      </div>

    </section>

    <section class="info-container col-sm-12 col-md-12 col-lg-8">
      <div class="row mb-4 container-title">
        <h2  class="title  col-sm-12 col-md-10">{{movie.title}}</h2>
        <span class="container-title-btn col-sm-12 col-md-2" >
          <button (click)="goBack()" class="btn btn-outline-pink">Regresar</button>
        </span>
      </div>
       <!-- Sinopsis -->
       <div>
        <!-- <h3 class="title">Sinopsis</h3> -->
        <p class="movie-overview">{{ movie.overview }}</p>
      </div>

      <h6 class="mb-4 title">
        <span> <i class="fas fa-star"></i>  {{ movie.vote_average }}</span>
        &nbsp;
        <span> <i class="fas fa-calendar-alt"></i> {{ movie.release_date }}</span>
      </h6>

      <!-- Genero -->
      <div class="container-genres mb-3">
        <button *ngFor="let genre of movie.genres" 
                class="btn btn-sm btn-dark mr-2">{{genre.name}}</button>
      </div>

      <!-- End Genero -->

      <hr>

      <!-- Elenco -->
      <div class="cast" *ngIf="movie.credits.cast as credits">
        <div class="row mb-4 container-title">
          <h3 class="title col-sm-12 col-md-10">Elenco</h3>
          <span class="container-title-btn col-sm-12 col-md-2">
            <button class="btn btn-outline-warning">Explorar</button>
          </span>
        </div>
        <div class="container-cast">
          <div class="card-cast" *ngFor="let credit of credits.slice(0, 7)">
            <img class="img-fluid shadow-lg cast__img" height="120px;" src="{{ credit.profile_path | image}}"
              alt="{{ credit.name }}">
            <p class="cast__name">{{ credit.name }}</p>
          </div>
        </div>
      </div>

    </section>
    <hr>

     <!-- Images -->
    <section class="col-sm-12 col-md-12 mb-3">
      
       <div class="images" *ngIf="movie.images as images">
        <div class="row mb-4 container-title">
          <h3 class="title col-sm-12 col-md-10">Posters</h3>
          <span class="container-title-btn col-sm-12 col-md-2">
            <button class="btn btn-outline-warning">Explorar</button>
          </span>
        </div>
        <div class="gallery" id="lightgallery"> 
          <div class="gallery__container" *ngFor="let image of movie.images.posters.slice(0,3)">
            <a target="_blank" href="{{ image.file_path | image}}">
              <img class="img-fluid" src="{{ image.file_path | image}}"
              alt="">
            </a>
          </div>
          
        </div>
      </div>
      <!--End  Images -->
    </section>
    <!-- END Images -->

    <div class="col-sm-12 col-md-12">
       <!-- Peliculas Similares -->

       <ng-container  *ngIf="movie.recommendations as recomendations "> 

        <div class="row mb-4 container-title" >
          <h3 class="title col-sm-12 col-md-10">Recomendaciones</h3>
          <span class="container-title-btn col-sm-12 col-md-2">
            <button class="btn btn-outline-warning">Explorar</button>
          </span>
        </div>
  
        <div style="margin-bottom:200px;">
  
          <div class="container-cast" *ngIf="recomendations.results.length >= 2; else movie">
  
            <!-- Tiene  2 o m치s recomendaciones -->
            
            <div class="card-cast mr-3" *ngFor="let r of recomendations.results.slice(0,7)">
              <img src="{{ r.poster_path | image}}" class="img-fluid   shadow-lg cast__img" alt="{{ r.title }}">
              <p class="cast__name">{{r.title}}</p>
            </div>
          </div>
  
          <ng-template #movie>
            <!-- Tiene 1 recomendacion -->
            <div class="card-cast" *ngIf="recomendations.results.length != 0">
              <img src="{{ recomendations[0].poster_path | image}}" class=" shadow-lg" alt="{{ recomendations[0].title }}"
                class="img-fluid  mr-3 shadow-lg cast__img">
              <p class="cast__name">{{recomendations[0].title}}</p>
            </div>
          </ng-template>
        </div>
      </ng-container>

      <!-- END Peliculas Similares -->
      <hr>
      <!-- Rese침as-->

      <ng-container *ngIf="movie.review as reviews">

        <div class="row mb-4 container-title" *ngIf="review.length>0">
          <h3 class="title col-sm-12 col-md-10">Rese침as</h3>
          <span class="container-title-btn col-sm-12 col-md-2">
            <button class="btn btn-outline-warning">Explorar</button>
          </span>
        </div>
  
        <div class="row" >
            <div class="col-sm-6" *ngFor="let review of reviews.results">
              <div class="card " style="background-color:transparent!important;border-radius: 15px;border:1px solid #FFF;">
                <div class="card-body">
                  <h5 class="card-title">{{ review.author | uppercase }}</h5>
                  <hr>
                  <p class="card-text">{{ review.content }}</p>
                  <a [href]="review.url" style="color:#FFF;" target="_blank" class="">Ver comentario</a>
                </div>
              </div>
            </div>
  
          </div>
      </ng-container>
        <!-- End Rese침as-->
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <app-loading></app-loading>
</ng-template>